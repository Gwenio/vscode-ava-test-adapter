# template for prepare the extension for packing
parameters:
  deps: true
  type: ""

steps:
  - script: pnpm install --prefer-frozen-lockfile --ignore-scripts
    displayName: Install Build Deps
    workingDirectory: meta/build
  - script: pnpx rollup -c
    displayName: Rollup Bundles
    workingDirectory: meta/build
    env:
      NODE_ENV: "${{ parameters.type }}"
  - script: |
      pnpm install --prefer-frozen-lockfile --ignore-scripts
      pnpx gulp prepare
    displayName: Prepare Pack Deps
    workingDirectory: meta/deps
    condition: and(succeeded(), eq('${{ parameters.deps }}', 'true'))
  - script: pnpx gulp prepare
    displayName: Add Pack Deps
    workingDirectory: meta/build
    condition: and(succeeded(), eq('${{ parameters.deps }}', 'true'))
  - script: pnpm install --prefer-frozen-lockfile --ignore-scripts
    displayName: Install Pack Deps
    workingDirectory: meta/build/extension
    condition: and(succeeded(), eq('${{ parameters.deps }}', 'false'))
